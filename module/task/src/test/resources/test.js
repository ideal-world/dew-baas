!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JVM=e()}}((function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.req=e.setServerUrl=e.setAkSk=e.setToken=e.setAppId=e.setSignature=e.setCurrentTime=e.setAjaxImpl=e.addMock=e.mock=void 0;let t,n,o,r,i="",c="",u="",a="";const s={};e.mock=function(e){for(let t in e)s[t.toLowerCase()]=e[t]},e.addMock=function(e,t){s[e.toLowerCase()]=t},e.setAjaxImpl=function(e){n=e},e.setCurrentTime=function(e){o=e},e.setSignature=function(e){r=e},e.setAppId=function(e){t=e},e.setToken=function(e){i=e},e.setAkSk=function(e,t){u=e,a=t},e.setServerUrl=function(e){e.trim().endsWith("/")&&(e=e.trim().substring(0,e.trim().length-1)),c=e},e.req=function(e,d,l,f,p,h){if(s.hasOwnProperty(e.toLowerCase()))return console.log("[Dew]Mock request [%s]%s",l,d),new Promise(t=>{t(s[e.toLowerCase()].call(null,l,d,f))});p=p||{},t&&(p["Dew-App-Id"]=t),p["Dew-Token"]=i||"";let A="/exec?Dew-Resource-Action="+l+"&Dew-Resource-Uri="+encodeURIComponent(d);!function(e,t,n){if(!u||!a)return;let i=t.split("?"),c=i[0],s=2===i.length?i[1]:"";s&&(s=s.split("&").sort((e,t)=>e<t?-1:1).join("&"));let d=o();n.Authorization=u+":"+r("post\n"+d+"\n"+c+"\n"+s,a),n["Dew-Date"]=d}(0,A,p);let b=c+A;return console.log("[Dew]Request [%s]%s , GW = [%s]",l,d,b),new Promise((e,t)=>{n(b,p,void 0===f?"":f).then(n=>{let o=n.data;h?e(o):"200"===o.code?e(o.body):(console.error("\u8bf7\u6c42\u9519\u8bef : ["+o.code+"]"+o.message),t("["+o.code+"]"+o.message))}).catch(e=>{console.error("\u670d\u52a1\u9519\u8bef : ["+e.message+"]"+e.stack),t(e.message)})})};var d,l,f,p,h,A={};Object.defineProperty(A,"__esModule",{value:!0}),A.AuthSubjectKind=A.ResourceKind=A.AccountIdentKind=A.CommonStatus=A.OptActionKind=void 0,(h=A.OptActionKind||(A.OptActionKind={})).EXISTS="EXISTS",h.FETCH="FETCH",h.CREATE="CREATE",h.MODIFY="MODIFY",h.PATCH="PATCH",h.DELETE="DELETE",(p=A.CommonStatus||(A.CommonStatus={})).DISABLED="DISABLED",p.ENABLED="ENABLED",(f=A.AccountIdentKind||(A.AccountIdentKind={})).USERNAME="USERNAME",f.AUTH_IDENT="AUTH-IDENT",f.PHONE="PHONE",f.EMAIL="EMAIL",f.WECHAT_XCX="WECHAT-XCX",(l=A.ResourceKind||(A.ResourceKind={})).MENU="MENU",l.ELEMENT="ELEMENT",l.OAUTH="OAUTH",l.RELDB="RELDB",l.CACHE="CACHE",l.MQ="MQ",l.OBJECT="OBJECT",l.TASK="TASK",l.HTTP="HTTP",(d=A.AuthSubjectKind||(A.AuthSubjectKind={})).TENANT="TENANT",d.APP="APP",d.ROLE="ROLE",d.GROUP_NODE="GROUP_NODE",d.ACCOUNT="ACCOUNT";var b={},E=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),S=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&E(t,e,n);return m(t,e),t};Object.defineProperty(b,"__esModule",{value:!0}),b.iamSDK=b.init=void 0;const O=S(e);let T,C=0;b.init=function(e){C=e};const D={fetchLoginInfo:()=>T,createLoginInfo(e){D.setLoginInfo(JSON.parse(e))},setLoginInfo(e){T=e,O.setToken(T.token)}},K={login:(e,t)=>(O.setToken(""),O.req("login","http://iam/common/login",A.OptActionKind.CREATE,{ak:e,sk:t,relAppId:C}).then(e=>(T=e,O.setToken(e.token),e))),logout:()=>O.req("logout","http://iam/common/logout",A.OptActionKind.DELETE).then(()=>{O.setToken("")}),registerAccount:e=>O.req("registerAccount","http://iam/console/tenant/account",A.OptActionKind.CREATE,{name:e}),createAccountIdent:(e,t,n,o)=>O.req("addAccountIdent","http://iam/console/tenant/account/"+e+"/ident",A.OptActionKind.CREATE,{kind:t,ak:n,sk:o}),bindApp:(e,t)=>O.req("bindApp","http://iam/console/tenant/account/"+e+"/app/"+t,A.OptActionKind.CREATE),bindRole:(e,t)=>O.req("bindRole","http://iam/console/tenant/account/"+e+"/role/"+t,A.OptActionKind.CREATE)},j={fetchMenu:()=>O.req("fetchMenu","menu://iam/common/resource?kind=menu",A.OptActionKind.FETCH),fetchEle:()=>O.req("fetchEle","element://iam/common/resource?kind=element",A.OptActionKind.FETCH),createResourceSubject:(e,t,n,o,r,i)=>O.req("createResourceSubject","http://iam/console/app/resource/subject",A.OptActionKind.CREATE,{codePostfix:e,kind:t,name:n,uri:o,ak:r,sk:i}),createResource:(e,t,n)=>O.req("createResource","http://iam/console/app/resource",A.OptActionKind.CREATE,{name:e,pathAndQuery:t,relResourceSubjectId:n})},_={createAuthPolicy:(e,t,n)=>O.req("createAuthPolicy","http://iam/console/app/authpolicy",A.OptActionKind.CREATE,{relSubjectKind:e,relSubjectIds:t,subjectOperator:"EQ",relResourceId:n,resultKind:"ACCEPT"})},y={registerTenant:(e,t,n,o)=>O.req("createTenant","http://iam/common/tenant",A.OptActionKind.CREATE,{tenantName:e,appName:t,accountUserName:n,accountPassword:o}),fetchTenant:()=>O.req("fetchTenant","http://iam/console/tenant/tenant",A.OptActionKind.FETCH)},v={createApp:e=>O.req("createApp","http://iam/console/tenant/app",A.OptActionKind.CREATE,{name:e}),fetchPublicKey:()=>O.req("fetchPublicKey","http://iam/console/app/app/publicKey",A.OptActionKind.FETCH),listAppIdents:()=>O.req("listAppIdents","http://iam/console/app/app/ident",A.OptActionKind.FETCH),fetchAppIdentSk:e=>O.req("fetchAppIdentSk","http://iam/console/app/app/ident/"+e+"/sk",A.OptActionKind.FETCH)},R={createRoleDef:(e,t)=>O.req("createRoleDef","http://iam/console/app/role/def",A.OptActionKind.CREATE,{code:e,name:t}),createRole:e=>O.req("createRole","http://iam/console/app/role",A.OptActionKind.CREATE,{relRoleDefId:e})};b.iamSDK={auth:{fetch:D.fetchLoginInfo,create:D.createLoginInfo,set:D.setLoginInfo},account:{login:K.login,logout:K.logout,register:K.registerAccount,bindApp:K.bindApp,bindRole:K.bindRole,ident:{create:K.createAccountIdent}},resource:{create:j.createResource,subject:{create:j.createResourceSubject},menu:{fetch:j.fetchMenu},ele:{fetch:j.fetchEle}},tenant:{register:y.registerTenant,fetch:y.fetchTenant},app:{create:v.createApp,ident:{list:v.listAppIdents,fetchSk:v.fetchAppIdentSk},key:{fetchPublicKey:v.fetchPublicKey}},role:{createRoleDef:R.createRoleDef,createRole:R.createRole},policy:{create:_.createAuthPolicy}};var I={},g=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),k=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),P=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&g(t,e,n);return k(t,e),t};Object.defineProperty(I,"__esModule",{value:!0}),I.CacheSDK=I.cacheSDK=I.init=void 0;const w=P(e);let M=0;I.init=function(e){M=e},I.cacheSDK=function(){return new x("default")};class x{constructor(e){this.resourceSubjectCode=M+".cache."+e}exists(e){return L(e),H("existsCache",this.resourceSubjectCode,A.OptActionKind.EXISTS,e)}hexists(e,t){return L(e),H("hexistsCache",this.resourceSubjectCode,A.OptActionKind.EXISTS,e+"/"+t)}get(e){return L(e),H("getCache",this.resourceSubjectCode,A.OptActionKind.FETCH,e)}hgetall(e){return L(e),H("hgetallCache",this.resourceSubjectCode,A.OptActionKind.FETCH,e+"/*")}hget(e,t){return L(e),H("hgetCache",this.resourceSubjectCode,A.OptActionKind.FETCH,e+"/"+t)}del(e){return L(e),H("delCache",this.resourceSubjectCode,A.OptActionKind.DELETE,e)}hdel(e,t){return L(e),H("hdelCache",this.resourceSubjectCode,A.OptActionKind.DELETE,e+"/"+t)}incrby(e,t){return L(e),H("incrbyCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e+"?incr=true",t+"")}hincrby(e,t,n){return L(e),H("hincrbyCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e+"/"+t+"?incr=true",n+"")}set(e,t){return L(e),H("setCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e,t)}hset(e,t,n){return L(e),H("hsetCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e+"/"+t,n)}setex(e,t,n){return L(e),H("setexCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e+"?expire="+n,t)}expire(e,t){return L(e),H("expireCache",this.resourceSubjectCode,A.OptActionKind.CREATE,e+"?expire="+t)}subject(e){return new x(e)}}function L(e){if(-1!==e.indexOf("/"))throw"key\u4e0d\u80fd\u5305\u542b[/]"}function H(e,t,n,o,r){return w.req(e,"cache://"+t+"/"+o,n,r)}I.CacheSDK=x;var N={},q=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),U=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),F=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&q(t,e,n);return U(t,e),t};Object.defineProperty(N,"__esModule",{value:!0}),N.HttpSDK=N.httpSDK=N.init=void 0;const B=F(e);let W=0;N.init=function(e){W=e},N.httpSDK=function(){return new X("default")};class X{constructor(e){this.resourceSubjectCode=W+".http."+e}get(e,t){return Q(this.resourceSubjectCode,A.OptActionKind.FETCH,e,t)}delete(e,t){return Q(this.resourceSubjectCode,A.OptActionKind.DELETE,e,t)}post(e,t,n){return Q(this.resourceSubjectCode,A.OptActionKind.CREATE,e,n,t)}put(e,t,n){return Q(this.resourceSubjectCode,A.OptActionKind.MODIFY,e,n,t)}patch(e,t,n){return Q(this.resourceSubjectCode,A.OptActionKind.PATCH,e,n,t)}subject(e){return new X(e)}}function Q(e,t,n,o,r){return n.startsWith("/")||(n="/"+n),o||(o={}),o["Content-Type"]="application/json charset=utf-8",B.req("http","http://"+e+n,t,r,o,!0)}N.HttpSDK=X;var Y={},J=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),G=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),z=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&J(t,e,n);return G(t,e),t};Object.defineProperty(Y,"__esModule",{value:!0}),Y.RelDBSDK=Y.reldbSDK=Y.init=void 0;const V=z(e);let Z=0;Y.init=function(e){Z=e},Y.reldbSDK=function(){return new $("default")};class ${constructor(e){this.resourceSubjectCode=Z+".reldb."+e}exec(e,t){return function(e,t,n){let o=t.trim().toLocaleLowerCase(),r=o.startsWith("select ")&&-1!==o.indexOf(" from ")?"FETCH":o.startsWith("insert ")&&-1!==o.indexOf(" into ")&&-1!==o.indexOf(" values ")?"CREATE":o.startsWith("update ")&&-1!==o.indexOf(" set ")&&-1!==o.indexOf(" where ")?"MODIFY":o.startsWith("delete ")&&-1!==o.indexOf(" where ")?"DELETE":o.startsWith("create table ")?"CREATE":null;if(null==r)throw"SQL\u64cd\u4f5c\u4e0d\u5408\u6cd5:"+t.trim();return V.req("reldb","reldb://"+e,A.OptActionKind[r],{sql:t.trim(),parameters:n})}(this.resourceSubjectCode,e,t)}subject(e){return new $(e)}}Y.RelDBSDK=$;var ee={},te=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),ne=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),oe=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&te(t,e,n);return ne(t,e),t};Object.defineProperty(ee,"__esModule",{value:!0}),ee.TaskSDK=ee.taskSDK=ee.init=void 0;const re=oe(e);let ie=0;ee.init=function(e){ie=e},ee.taskSDK=function(){return new ce("default")};class ce{constructor(e){this.resourceSubjectCode=ie+".task."+e}initTasks(e){return ue("initTasks",this.resourceSubjectCode,A.OptActionKind.CREATE,"task",e)}create(e,t,n){let o="";return n&&(o="?cron="+encodeURIComponent(n)),ue("createTask",this.resourceSubjectCode,A.OptActionKind.CREATE,"task/"+e+o,t)}modify(e,t,n){let o="";return n&&(o="?cron="+encodeURIComponent(n)),ue("modifyTask",this.resourceSubjectCode,A.OptActionKind.MODIFY,"task/"+e+o,t)}delete(e){return ue("deleteTask",this.resourceSubjectCode,A.OptActionKind.DELETE,"task/"+e)}execute(e,t){return ue("executeTask",this.resourceSubjectCode,A.OptActionKind.CREATE,"exec/"+e,t)}subject(e){return new ce(e)}}function ue(e,t,n,o,r){return re.req(e,"task://"+t+"/"+o,n,r,{"Content-Type":"text/plain"})}ee.TaskSDK=ce;var ae={},se=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),de=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),le=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&se(t,e,n);return de(t,e),t};Object.defineProperty(ae,"__esModule",{value:!0}),ae.SDK=void 0;const fe=le(e),pe=le(b),he=le(I),Ae=le(N),be=le(Y),Ee=le(ee);ae.SDK={init:function(e,t){ae.SDK.setting.serverUrl(e),ae.SDK.setting.appId(t)},iam:pe.iamSDK,reldb:be.reldbSDK(),cache:he.cacheSDK(),http:Ae.httpSDK(),task:Ee.taskSDK(),setting:{serverUrl:function(e){fe.setServerUrl(e)},appId:function(e){fe.setAppId(e),pe.init(e),be.init(e),he.init(e),Ae.init(e),Ee.init(e),ae.SDK.reldb=be.reldbSDK(),ae.SDK.cache=he.cacheSDK(),ae.SDK.http=Ae.httpSDK(),ae.SDK.task=Ee.taskSDK()},aksk:function(e,t){fe.setAkSk(e,t)},ajax:function(e){fe.setAjaxImpl(e)},currentTime:function(e){fe.setCurrentTime(e)},signature:function(e){fe.setSignature(e)}}};var me={};Object.defineProperty(me,"__esModule",{value:!0}),me.DewSDK=void 0,me.DewSDK=ae.SDK;var Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.addItem=Se.fetchItems=Se.init=Se.db=void 0,Se.db=me.DewSDK.reldb.subject("todoDB"),Se.init=async function(){await Se.db.exec("create table if not exists todo\n(\n    id bigint auto_increment primary key,\n    create_time timestamp default CURRENT_TIMESTAMP null comment '\u521b\u5efa\u65f6\u95f4',\n    create_user varchar(255) not null comment '\u521b\u5efa\u8005OpenId',\n    content varchar(255) not null comment '\u5185\u5bb9'\n)\ncomment '\u4efb\u52a1\u8868'",[]),await Se.db.exec("insert into todo(content,create_user) values (?,?)",["\u8fd9\u662f\u4e2a\u793a\u4f8b",""])},Se.fetchItems=async function(){return async function(){return null==me.DewSDK.iam.auth.fetch()?[]:me.DewSDK.iam.auth.fetch().roleInfo.some(e=>"APP_ADMIN"===e.defCode)?Se.db.exec("select * from todo",[]):Se.db.exec("select * from todo where create_user = ?",[me.DewSDK.iam.auth.fetch().accountCode])}()},Se.addItem=async function(e){if(null==me.DewSDK.iam.auth.fetch())throw"\u8bf7\u5148\u767b\u5f55";return await me.DewSDK.cache.set("xxx",e),Se.db.exec("insert into todo(content,create_user) values (?, ?)",[e,me.DewSDK.iam.auth.fetch().accountCode]).then(()=>null)};var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.ioTestDtos=Oe.ioTestDto=Oe.ioTestMap=Oe.ioTestObj=Oe.ioTestArr=Oe.ioTestNum=Oe.ioTestStr=Oe.removeItem=void 0,Oe.removeItem=async function(e){return me.DewSDK.iam.auth.fetch().roleInfo.some(e=>"APP_ADMIN"===e.defCode)?Se.db.exec("delete from todo where id = ? ",[e]).then(()=>null):Se.db.exec("delete from todo where id = ? and create_user = ?",[e,me.DewSDK.iam.auth.fetch().accountCode]).then(e=>{if(1===e[0])return null;throw"\u6743\u9650\u9519\u8bef"})},Oe.ioTestStr=async function(e,t,n,o){return e},Oe.ioTestNum=async function(e,t,n,o){return t},Oe.ioTestArr=async function(e,t,n,o){return n},Oe.ioTestObj=async function(e,t,n,o){return o},Oe.ioTestMap=async function(e){return e.add="add",e},Oe.ioTestDto=async function(e){return e.createUserId="100",e},Oe.ioTestDtos=async function(e){return e[0].createUserId="100",e};var Te={};return Object.defineProperty(Te,"__esModule",{value:!0}),Te.DewSDK=me.DewSDK,Te.TodoAction1_test=Se,Te.TodoAction2_test=Oe,Te}));
